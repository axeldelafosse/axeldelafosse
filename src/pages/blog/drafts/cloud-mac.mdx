export const meta = {
  uid: 'cloud-mac',
  title: 'Cloud Mac',
  description: `How to create your Mac living in the cloud.`,
  date: '2021-04-30',
  dateLastModified: '2021-05-01'
}

<PostHead {...meta} />

# Cloud Mac

## How to create your Mac living in the cloud.

Wouldn't it be cool if you could have an always-on, self-upgrading and very fast
Mac living in the cloud?

> "The whole idea of "your computer" is going away, and being replaced with "your data." You should be able to get at your data from any computer. Or rather, any client, and a client doesn't have to be a computer." - Paul Graham, [The Other Road Ahead](http://www.paulgraham.com/road.html)

Benefits:

- Your Mac is always on and you can access it anywhere, anytime (even from your iPhone or iPad)
- Upgrade to the latest hardware every year (without changing your Mac)
- Access to datacenter hardware you couldn't use otherwise (faster vCPUs, better GPUs, 10 Gbps network bandwidth...)
- Your Mac follows you everywhere around the world, as if it was in your pocket
  (your disk is an Amazon EBS volume that you can backup to another location and link to a new host)
- Increase storage in a few click
- Stream VSCode, Xcode, Android Studio (put your dev environment in the cloud)
- Self-hosted (privacy and security included)
- And much more...

We are seeing this trend emerge in gaming with Shadow, Parsec, and Google Stadia -- just to name a few.
The streaming tech is working. So I wanted to experiment with a Cloud Mac to supercharge my
app development workflow.

Disclaimer: this is a failed experiment. The issue currently is pricing. It costs
too much to have a Mac dedicated host on AWS. Maybe we can create a Cloud Hackintosh?
It would be much cheaper with a `t3a` instance for example.
I'm going to look into [OSX-KVM](https://github.com/kholia/OSX-KVM).

I won't improve this draft but I decided to link to it in another experiment, [Sidecar Mac](/blog/sidecar-mac).
Feel free to ask me any questions if the instructions aren't clear, I may have forgotten something.

Here is how to set up a Cloud Mac on AWS:

**Start**

`aws ec2 allocate-hosts --availability-zone "eu-west-1a" --region "eu-west-1" --auto-placement "on" --host-recovery "off" --quantity 1 --instance-type "mac1.metal"`

Create instance and EBS volume (don't delete on termination)

`aws ec2 run-instances --region eu-west-1 --instance-type mac1.metal --image-id ami-074e62791760c7880 --key-name axel --associate-public-ip-address`

**Connect**

`ssh -i axel.pem ec2-user@ec2-34-242-185-1.eu-west-1.compute.amazonaws.com`

`sudo passwd ec2-user`

`sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -activate -configure -access -on -restart -agent -privs -all`

**Connect VNC**

`ssh -L 5900:localhost:5900 -i axel.pem ec2-user@ec2-54-154-233-221.eu-west-1.compute.amazonaws.com`

`open vnc://localhost`

**Resize the APFS container to match EBS volume size**

`PDISK=$(diskutil list physical external | head -n1 | cut -d" " -f1)`

`APFSCONT=$(diskutil list physical external | grep "Apple_APFS" | tr -s " " | cut -d" " -f8)`

`sudo diskutil repairDisk $PDISK`

Accept the prompt with "y", then paste this command

`sudo diskutil apfs resizeContainer $APFSCONT 0`

**Patch EDID AWS Nitro Display**

`sudo defaults write /Library/Preferences/com.apple.windowserver.plist DisplayResolutionEnabled -bool true`

`sudo mkdir -p /Library/Displays/Contents/Resources/Overrides`

Install Remotix Agent and get computer ID

Copy AWS Nitro Display .plist to inject EDID: /Library/Displays/Contents/Resources/Overrides/DisplayVendorID-6f3/[DisplayProductID-6604](https://gist.github.com/axeldelafosse/269a7f5e43701041fb5fb07219207be1)

**Settings**

Create a new admin user then log in -> ask for username

`sudo chown -R $USER:admin /usr/local/*`

`brew install blackhole-2ch`

Connect with Remotix NEAR

Download [RDM](https://github.com/avibrazil/RDM) and add to Users & Groups > Login Items to open at startup

Set sound output to BlackHole (in Audio Midi Setup) to get the Sound Redirection

You may want to use Reduce Motion

Set correct time
